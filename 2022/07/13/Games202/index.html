<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Games202学习小结"><meta name="keywords" content><meta name="author" content="wyzwzz"><meta name="copyright" content="wyzwzz"><title>Games202学习小结 | wyzwzz 的博客</title><link rel="shortcut icon" href="/my-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.6.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#1B9EF3"><meta name="msapplication-TileColor" content="#1B9EF3"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#1B9EF3"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-2188191456032650',
  enable_page_level_ads: 'true'
});
</script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?295ad5c5a196e4964e20f74260711177";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-114899088-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"5WEDOKLFCL","apiKey":"26a57bfa5275b7c98a3b3ab7dae61915","indexName":"wyzwzz-blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#最终实现效果"><span class="toc-number">1.</span> <span class="toc-text"> 最终实现效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#作业1-shadowmap"><span class="toc-number">2.</span> <span class="toc-text"> 作业1 ShadowMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#作业2-prt"><span class="toc-number">3.</span> <span class="toc-text"> 作业2 PRT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#作业3-ssrt"><span class="toc-number">4.</span> <span class="toc-text"> 作业3 SSRT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#作业4-kullaconty-brdf"><span class="toc-number">5.</span> <span class="toc-text"> 作业4 KullaConty BRDF</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/doraemon.jpeg"></div><div class="author-info__name text-center">wyzwzz</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">2</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://molunerfinn.com/">MARKSZのBlog</a><a class="author-info-links__name text-center" href="https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md">提问的智慧</a><a class="author-info-links__name text-center" href="https://zh.wikipedia.org/">中文维基百科</a><a class="author-info-links__name text-center" href="https://zbqtesla.github.io">ZBQTesla的博客</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/background.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">wyzwzz 的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="https://mirror.wyzwzz.site">Mirror</a><a class="site-page" href="https://music.wxhbts.com">音乐</a><a class="site-page" href="https://writing.wyzwzz.site">Writing</a><a class="site-page" href="/about">关于</a><a class="site-page" href="/rss">RSS</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Games202学习小结</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-07-13</time><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3k</span><span class="post-meta__separator">|</span><span>阅读时长: 9 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>这一周刚好七天重新写了一边Games202的前四个作业，把以前有漏洞或者没有涉及的Bouns部分也全部解决和实现，显示的效果还不错，代码量（包括Shader）估计在3500行左右，这还是OpenGL包装过以及使用一些小轮子的情况下…lambda函数嵌套用起来真优雅，不过编译报错也是看的人废了。</p>
<p><a href="https://github.com/wyzwzz/Games202-OpenGL" target="_blank" rel="noopener">仓库链接</a></p>
<a id="more"></a>
<h2 id="最终实现效果"><a class="markdownIt-Anchor" href="#最终实现效果"></a> 最终实现效果</h2>
<p><img src="1-ShadowMap_PCSS.png" alt="ShadowMap"><br>
<img src="2-PRT.png" alt="PRT"><br>
<img src="3-SSRT.png" alt="SSRT"><br>
<img src="4-KullaContyBRDF_OFF.png" alt="KullaConty BRDF OFF"><br>
<img src="4-KullaContyBRDF_ON.png" alt="KullaConty BRDF ON"></p>
<h2 id="作业1-shadowmap"><a class="markdownIt-Anchor" href="#作业1-shadowmap"></a> 作业1 ShadowMap</h2>
<p>ShadowMap的基本思路为：将相机放在光源处看向场景，记录深度信息，一般方向光对应正交投影，<br>
而聚光灯或者点光源对应透视投影，以及此时的View和Proj矩阵，记为LVP。有了深度信息后，正常渲染时，在片段着色器中，可以获取片段的位置变量pos，使用LVP对其进行变换。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>l</mi><mi>i</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>p</mi><mi>o</mi><mi>s</mi><mo>=</mo><mi>L</mi><mi>V</mi><mi>P</mi><mo>∗</mo><mi>v</mi><mi>e</mi><mi>c</mi><mn>4</mn><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator="true">,</mo><mn>1.0</mn><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>n</mi><mi>d</mi><mi>c</mi><mo>=</mo><mi>c</mi><mi>l</mi><mi>i</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi>c</mi><mi>l</mi><mi>o</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi mathvariant="normal">.</mi><mi>w</mi><mspace linebreak="newline"></mspace><mi>u</mi><mi>v</mi><mo>=</mo><mi>n</mi><mi>d</mi><mi>c</mi><mi mathvariant="normal">.</mi><mi>x</mi><mi>y</mi><mo>∗</mo><mn>0.5</mn><mo>+</mo><mn>0.5</mn><mspace linebreak="newline"></mspace><mi>z</mi><mo>=</mo><mi>n</mi><mi>d</mi><mi>c</mi><mi mathvariant="normal">.</mi><mi>z</mi><mo>∗</mo><mn>0.5</mn><mo>+</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">clip\_pos = LVP * vec4(pos,1.0)\\
ndc = clip\_pos / clop\_pos.w \\
uv = ndc.xy * 0.5 + 0.5 \\
z = ndc.z * 0.5 + 0.5 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault">p</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord">4</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">0</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault">p</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord">/</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">c</span><span class="mord">.</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">c</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span></span></span></p>
<p>注意OpenGL下NDC的xyz范围都是-1~1<br>
如果uv都是0到1之间，说明在相机视角下的这个片段位置，也可以被灯光看见，可以根据uv从<br>
之前的深度信息图中查询到该片段在灯光视角下的深度值lz，将其与计算得到的z值<br>
做比较，如果z &gt; lz，说明该片段被遮挡住了。</p>
<p>但是这样子会造成一个问题，因为记录深度信息的纹理分辨率是有限的，因此图中的一个像素，<br>
代表一个投影区域中心的深度值，任何在该区域内的其它位置，在第二步渲染查询深度值时，都将是一样的，这样子就会导致物体表面出现自遮挡现象，像是黑色的摩尔纹，放一下课件里的图。<br>
<img src="self_shadow.png" alt="self shadow"></p>
<p>解决这个问题，一般思路是满足 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi><mo>−</mo><mi>e</mi><mi>p</mi><mi>s</mi><mo>&gt;</mo><mi>l</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">z - eps &gt; lz</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span></span></span></span> 才被认为遮挡住，eps可以根据片段法向量和实现的夹角来缩放，<br>
实际中，可以将原来的pos沿着normal移动eps的距离再进行变换。</p>
<p>解决自遮挡的问题后，还是有一定的问题，比如受限于深度图的分辨率，阴影会出现锯齿，一个简单而自然的想法就是对阴影进行过滤、模糊，即计算一个片段的阴影系数时，不再是0或者1，而是0~1之间，这就是PCF的思路。最简单的做法，就是取固定的滤波核，比如5x5，滤波核取得越大，阴影越模糊，反之阴影越尖锐。滤波范围理论上取圆盘区域可能更加符合实际，因此也可以划定一个半径，然后均匀采样深度信息图上圆盘内的其它深度值，与z作比较，求出阴影系数的平均值。作业还提供了圆盘泊松采样的方法，类似于一种由中心向外的螺旋线。</p>
<p>然而现实中的阴影其实是hard和soft兼具的，被遮挡的点里遮挡物越近，阴影越尖锐，反之则越模糊。放一张闫老师特别称赞的一张图。<br>
<img src="pen_shadow.png" alt="percentage shadow"></p>
<p>可以观察到，笔尖的阴影边界特别清晰，而远一点的阴影边界则自带模糊，我觉得这张图对形成原因解释地比较清晰。<br>
模糊的阴影形成是因为部分光线被遮挡。因此PCSS的基本思路就是找出适当的滤波区域大小，再进行PCF过滤。<br>
<img src="sun_shadow.png" alt="sun earth shadow"></p>
<p>PCSS的原理图如下。<br>
<img src="pcss.png" alt="pcss"><br>
阴影的滤波区域大小与三个变量有关，灯光区域大小、遮挡物的深度和阴影处的深度。其中唯一不知道的就是遮挡物的深度，但还是要用平均深度替代，因此为了求这个平均深度，我们需要PCF求出平均遮挡深度，再根据这个平均遮挡深度求出滤波半径，再进行一次PCF，相当于两次的PCF，因此PCSS一般比PCF更消耗性能，但是获得的效果也会更好。另外，求平均遮挡深度时的PCF的滤波范围大小怎么确定呢？可以是固定的，不过更好的做法是根据光源的大小和遮挡处的深度。<br>
<img src="search_radius.png" alt="search radius"><br>
将深度图放在灯光的近平面（假设不是方向光源，因为方向光源理论上不会产生软阴影），根据相似三角形关系可以求出滤波核在深度图上的对应大小。然后套用PCF求出遮挡的平均深度即可。实际应用时，光源的大小和近平面的大小需求调整到合适的范围。</p>
<h2 id="作业2-prt"><a class="markdownIt-Anchor" href="#作业2-prt"></a> 作业2 PRT</h2>
<h2 id="作业3-ssrt"><a class="markdownIt-Anchor" href="#作业3-ssrt"></a> 作业3 SSRT</h2>
<p>屏幕空间反射（光线追踪），建立在延迟渲染的基础上，也就是说进行光线追踪的信息来源于GBuffer，并不是整个场景的信息，所以它并不是那么准确，比如对于一个处于阴影处的物体，它的光照只能来源于间接光，但是如果屏幕中没有其它被直接光照射的物体，那么它就没有光照来源，只能为黑色，或者靠着ambient环境光证明自己的存在。但是SSR当然尤其好处，就是可以做到光栅化无法解决的反射求交问题。在光栅化流水线中，如果想要对一根射线与场景三角形求交是十分困难的，如果是OpenGL只能是自己动手实现一下BVH？见过大佬实现过orz…而对于SSR，可以很简单地使用ray marching求出反射光线的交点，当然ray marching这一方法本身是比较消耗性能的，不过也有优化加速的方法，因此ssr在特定场景（比如限制相机视角）效果还是十分好的。ssr的原理和流程图如下，其实还是十分简单的。<br>
<img src="ssr.png" alt="ssr"></p>
<p>ssr建立在延迟渲染的基础上，那么就需要GBuffer，如上图，需要pos、normal、albedo、view depth，前三者是vec3类型，最后一个float类型，如果简单的话，我们需要四张二维纹理，其中pos应该需要rgb32f，normal和albedo可以使用rgb8，而view depth要使用r32f。综合下来，虽然内存使用是不大的，但是每次从GBuffer中读取这些信息，是有代价的，现在需要从四张纹理中读取，还是可以进行压缩的。其中normal和albedo可以进行压缩，从vec3变为vec2，因此所有的GBuffer最终只需要两张rgba32f即可。</p>
<p>法向量的压缩算法可以参考<a href="https://www.shadertoy.com/view/llfcRl" target="_blank" rel="noopener">这个</a></p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="type">vec2</span> octWrap(<span class="type">vec2</span> v)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1.0</span> - <span class="built_in">abs</span>(v.yx)) * (<span class="built_in">all</span>(<span class="built_in">greaterThanEqual</span>(v.xy, <span class="type">vec2</span>(<span class="number">0.0</span>))) ? <span class="type">vec2</span>(<span class="number">1.0</span>) : <span class="type">vec2</span>(<span class="number">-1.0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> encode(<span class="type">vec3</span> n)</span><br><span class="line">&#123;</span><br><span class="line">    n /= (<span class="built_in">abs</span>(n.x) + <span class="built_in">abs</span>(n.y) + <span class="built_in">abs</span>(n.z));</span><br><span class="line">    n.xy = n.z &gt;= <span class="number">0.0</span> ? n.xy : octWrap(n.xy);</span><br><span class="line">    <span class="keyword">return</span> n.xy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">vec3</span> decode(<span class="type">vec2</span> f)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">vec3</span> n = <span class="type">vec3</span>(f.x, f.y, <span class="number">1.0</span> - <span class="built_in">abs</span>(f.x) - <span class="built_in">abs</span>(f.y));</span><br><span class="line">    <span class="type">float</span> t = <span class="built_in">clamp</span>(-n.z, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    n.xy += <span class="built_in">all</span>(<span class="built_in">greaterThanEqual</span>(n.xy, <span class="type">vec2</span>(<span class="number">0.0</span>))) ? <span class="type">vec2</span>(-t) : <span class="type">vec2</span>(t);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">normalize</span>(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于颜色，直接将r和b通道压缩为float16当作一个float32进行存储即可，代码如下。</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="comment">//encode</span></span><br><span class="line"><span class="type">vec3</span> color  = albedo / <span class="number">3.14159265</span>;</span><br><span class="line"><span class="type">float</span> color1 = <span class="built_in">uintBitsToFloat</span>(<span class="built_in">packHalf2x16</span>(color.rb));</span><br><span class="line"><span class="type">float</span> color2 = color.g;</span><br><span class="line"><span class="comment">//decode</span></span><br><span class="line"><span class="type">vec2</span> color1 = <span class="built_in">unpackHalf2x16</span>(<span class="built_in">floatBitsToUint</span>(p1.x));</span><br><span class="line"><span class="type">vec3</span> albedo = <span class="type">vec3</span>(color1.x, p1.g, color1.y);</span><br></pre></td></tr></table></figure>
<p>直接光的光照计算直接采用公式，计算完后存储到一张纹理中，作为计算间接光时的输入。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></msub><mo>=</mo><mi>B</mi><mi>R</mi><mi>D</mi><mi>F</mi><mo>∗</mo><msub><mi>L</mi><mrow><mi>l</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo>∗</mo><mi>V</mi><mi>i</mi><mi>s</mi><mo>∗</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">L_{direct} = BRDF * L_{light} * Vis * \cos\theta
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span></span></span></p>
<p>间接光的计算采用蒙特卡洛采用，使用z-weight半球采样，对应diffuse材质，公式为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mfrac><mrow><mi>B</mi><mi>R</mi><mi>D</mi><mi>F</mi><mo>∗</mo><msub><mi>L</mi><mi>i</mi></msub><mo>∗</mo><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mo>⋅</mo><msub><mi>ω</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mi>p</mi><mi>d</mi><mi>f</mi><mo stretchy="false">(</mo><msub><mi>ω</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mfrac><mspace linebreak="newline"></mspace><mo>=</mo><mfrac><mi>π</mi><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mi>B</mi><mi>R</mi><mi>D</mi><mi>F</mi><mo>∗</mo><msub><mi>L</mi><mrow><mi>i</mi><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_{indirect} = \frac{1}{N}\sum^{N}_{i = 1}\frac{BRDF * L_i * 
(\omega_{i}\cdot \omega_{n})}{pdf(\omega_{i})}\\
=\frac{\pi}{N}\sum^{N}_{i=1}BRDF * L_{i direct}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.10756em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>这里去掉了Vis项，因为通过ray marching找到的都是可见的，否则直接跳过这次采样。<br>
对于线性的ray marching，也就是说光线在view space中按照固定步长前进，每次都要判断当前的位置是不是小于通过纹理查得的z值，如果小于则说明光线与该片段相交，即该被直接光照射的片段，可以被计算间接光这一片段看见，作为间接光的入射光源。这里其实会存在一个问题，那就是当判断当前光线所处的片段比z值小时，还有一个情况就是光线当前位置处于直接光照射的阴影处，这样子就会造成虚假的间接光入射源，特别是断层附近，低处会突然比较亮，如下图。<br>
<img src="depth_threshold_wrong.png" alt="depth threshold off"><br>
<img src="depth_threshold_right.png" alt="depth threshold on"><br>
右图是进行了DepthThreshold判断后的结果，即光线位置的深度不可以小于z值太多，因此光线每一步前进的步长Step和DepthThreshold这两个变量的值是相互关系的。</p>
<p>线性ray marching还是很简单的，在间接光着色时，根据片段的当前位置，以及半球采样的方向发出一条光线，每一步前进固定大小的距离，每次都判断当前位置对应的view depth是不是比纹理记录的要小，以及如果当前光线已经跑出view空间范围了，如果满足所有要求，则返回true和直接光信息，累加起来就好。至于效率，当然是不太好，因为每次前进的距离都是固定的，在找到满足条件的位置前，有很多不必要的循环计算和查表，因此可以使用mipmap进行加速，建立view depth的mipmap，使用最小值策略。在光线前进时，如果当前位置深度大于某一lod下对应的深度，那么可以直接跳过这一lod这一像素对应的范围。这里就有一个重要的点，在view space里的以均匀步长前进是一种浪费，因为最后的深度纹理还要经过project变换才能得到，也就是说，view space里某个方向上两个点之间的连线经过project后，它的长度不是线性变化的，在投射投影下。另外它所代表的像素范围可能很小，即我们在view space里线性前进的步长设置应该根据view depth图像的分辨率来调整。不过由于投射摄影下，即便是同一方向上固定距离的两个点，随着它们与相机距离的变化，它们经过投影变化后在图像上代表的范围也会发生变化。比如根据近大远小，在远处前进距离x，对应查询的纹理范围更小，假设占据1个像素，而在近处前进距离x，对应查询的纹理范围就更大，可能为6个像素，因此为了有效利用，显而易见应该在远处以更大的步长前进，这个比例理论上可以找到的，根据z值和view space下方向的方向，不过很麻烦，简单的做法是在ncd坐标系下进行。在ndc坐标系下，计算view space下光线在ndc坐标系中的方向，以在ndc坐标系下固定的步长前进，对应到view space就是一种自适应采样步长的方法，这里都没有涉及到mipmap。</p>
<h2 id="作业4-kullaconty-brdf"><a class="markdownIt-Anchor" href="#作业4-kullaconty-brdf"></a> 作业4 KullaConty BRDF</h2>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">wyzwzz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wyzwzz.site/2022/07/13/Games202/">https://wyzwzz.site/2022/07/13/Games202/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wyzwzz.site">wyzwzz 的博客</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/07/13/SoftPBRRenderer/"><i class="fa fa-chevron-left">  </i><span>IBL的一些小结和实现</span></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'true' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'wiHsGgANF4mLmK2Hiubzew03-gzGzoHsz',
  appKey:'Tk0WjoOhLD8ppTfyhdCbyeDT',
  placeholder:'Just go go',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer class="footer-bg" style="background-image: url(/img/background.png)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2022 By wyzwzz</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/algolia.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>